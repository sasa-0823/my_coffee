<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/header.css">
  <title>ホーム - BrewShare</title>
</head>

<body>
  <header th:fragment="header">
    <div class="menu">
      <ul>
        <li class="active"><a th:href="@{/}">logo</a></li>
        <li>
          <form type="search" method="get" th:action="@{/search}">
            <input type="text" name="beanSearch" placeholder="豆の種類を入力" required>
            <button class="btn">検索</button>
          </form>
        </li>
        <li>アイコン
          <div class="sub_menu">
            <ul>
              <li><a th:href="@{/mypage}">マイページ</a></li>
              <li><a th:href="@{/Favorite}">ブックマーク</a></li>
              <li>
                <a th:href="@{/logout}"
                  onclick="event.preventDefault(); document.getElementById('logout-form').submit();">ログアウト
                </a>
                <form id="logout-form" th:action="@{/logout}" method="post"></form>
              </li>
            </ul>
          </div>
        </li>
        <li><a th:href="@{/createRecipe}">レシピ追加</a></li>
      </ul>
    </div>
  </header>

  <main>

    <h3>ユーザー名</h3>
    <h3 th:text="${user.name}"></h3>

    <h5>【recipe一覧】</h5>

    <div class="menu_list" th:fragment="recipeList">
      <ul>
        <div:block th:each="rl:${recipeList}" class="listpackage">

          <li>
            <img th:src="@{/user_icon/{img}(img=${rl.user.img})}" alt="ユーザーアイコン">
            <span>ユーザー名</span>
            <span th:text="${rl.user.name} ?: '未入力'"></span>

            <span>豆の名前</span>
            <span th:text="${rl.bean.name} ?: '未入力'"></span>

            <span>豆の量</span>
            <span th:text="${rl.beansWeight != null ? rl.beansWeight + 'g' : '未入力'}"></span>

            <span>水の量</span>
            <span th:text="${rl.waterVolume != null ? rl.waterVolume + 'ml' : '未入力'}"></span>

            <span>水温</span>
            <span th:text="${rl.waterTemp != null ? rl.waterTemp + '℃' : '未入力'}"></span>


            <a th:if="${rl.isSameUser}" th:href="@{/edit/{rlId}/{userId}(rlId = ${rl.id}, userId = ${rl.user.id})}">
              <input type="button" value="編集">
            </a>

            <a th:if="${rl.isSameUser}" th:href="@{/delete/{rlId}(rlId = ${rl.id})}">
              <input type="button" id="delete" value="削除">
            </a>

            <button th:data-beanName="${rl.bean.name}" th:data-roast="${rl.roast}" th:data-grindSize="${rl.grindSize}"
              th:data-beansWeight="${rl.beansWeight}" th:data-waterVolume="${rl.waterVolume}"
              th:data-waterTemp="${rl.waterTemp}" th:data-steamingTime="${rl.steamingTime}"
              th:data-dripper="${rl.dripper}" th:data-filter="${rl.filter}" th:data-memo="${rl.memo}"
              onclick="openModal(this)">
              詳細確認
            </button>

            <a th:unless="${rl.isSameUser}" th:href="@{/Favorite/{rlId}(rlId = ${rl.id})}">
              <input type="button" id="Favorite" value="お気に入り">
            </a>

          </li>
        </div:block>

        <div id="modal" class="model" style="display: none;">
          <div class="modelHeader">
            <h2>レシピ詳細</h2>
          </div>
          <div class="modelContent">
            <table>
              <tr>
                <th>豆の名前</th>
                <td id="name"></td>
              </tr>
              <tr>
                <th>焙煎度</th>
                <td id="roast">未入力</td>
              </tr>
              <tr>
                <th>粗度</th>
                <td id="grindSize">未入力</td>
              </tr>
              <tr>
                <th>豆の重さ</th>
                <td id="beansWeight">未入力</td>
              </tr>
              <tr>
                <th>水の量</th>
                <td id="waterVolume">未入力</td>
              </tr>
              <tr>
                <th>水の温度</th>
                <td id="waterTemp">未入力</td>
              </tr>
              <tr>
                <th>蒸らし温度</th>
                <td id="steamingTime">未入力</td>
              </tr>
              <tr>
                <th>ドリッパー</th>
                <td id="dripper">未入力</td>
              </tr>
              <tr>
                <th>フィルター</th>
                <td id="filter">未入力</td>
              </tr>
              <tr>
                <th>メモ</th>
                <td id="memo">未入力</td>
              </tr>
            </table>

            <input type="button" value="閉じる" id="modelClose" onclick="closeModal()">

          </div>
        </div>

      </ul>
      <script>
        const modal = document.getElementById("modal")

        function openModal(button) {
          modal.style.display = "block";

          const beanName = button.getAttribute("data-beanName");
          const roast = button.getAttribute("data-roast");
          const grindSize = button.getAttribute("data-grindSize");
          const beansWeight = button.getAttribute("data-beansWeight");
          const waterVolume = button.getAttribute("data-waterVolume");
          const waterTemp = button.getAttribute("data-waterTemp");
          const steamingTime = button.getAttribute("data-steamingTime");
          const dripper = button.getAttribute("data-dripper");
          const filter = button.getAttribute("data-filter");
          const memo = button.getAttribute("data-memo");

          document.getElementById("name").innerText = beanName ? beanName : "未入力";
          document.getElementById("roast").innerText = roast ? roast : "未入力";
          document.getElementById("grindSize").innerText = grindSize ? grindSize : "未入力";
          document.getElementById("beansWeight").innerText = beansWeight ? beansWeight : "未入力";
          document.getElementById("waterVolume").innerText = waterVolume ? waterVolume : "未入力";
          document.getElementById("waterTemp").innerText = waterTemp ? waterTemp : "未入力";
          document.getElementById("steamingTime").innerText = steamingTime ? steamingTime : "未入力";
          document.getElementById("dripper").innerText = dripper ? dripper : "未入力";
          document.getElementById("filter").innerText = filter ? filter : "未入力";
          document.getElementById("memo").innerText = memo ? memo : "未入力";
        }

        const closeModal = () => {
          modal.style.display = "none";
        };

        document.addEventListener("click", (e) => {
          if (e.target == modal) {
            modal.style.display = "none";
          }
        })
      </script>
    </div>

  </main>

</body>

</html>